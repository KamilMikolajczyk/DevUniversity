@using Microsoft.AspNetCore.Identity
@using University.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] — University</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root { --bg0: #0b1220; --bg1:#0f172a; }
        body{
            background: radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,.25), transparent 60%),
                        radial-gradient(900px 500px at 90% 20%, rgba(16,185,129,.20), transparent 55%),
                        linear-gradient(180deg, var(--bg0), var(--bg1));
            min-height: 100vh;
        }
        .glass { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); backdrop-filter: blur(10px); }
        .brand-dot{ display:inline-block; width:10px; height:10px; border-radius:99px; background: linear-gradient(135deg, #22c55e, #6366f1); margin-right:.5rem; }
        .page-shell { max-width: 1100px; }
        .card-soft { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); border-radius: 18px; }
        .text-muted2 { color: rgba(255,255,255,.65) !important; }
        .nav-link { color: rgba(255,255,255,.75) !important; }
        .nav-link:hover { color: #fff !important; }
        .form-control, .form-select, textarea {
            background: rgba(255,255,255,.06) !important;
            border: 1px solid rgba(255,255,255,.14) !important;
            color: #fff !important;
        }
        .form-control::placeholder { color: rgba(255,255,255,.55); }
        .form-control:focus, .form-select:focus, textarea:focus { border-color: rgba(255,255,255,.35) !important; box-shadow: 0 0 0 .2rem rgba(99,102,241,.18) !important; }

        /* --- HARD FIX: Bootstrap tables in dark/glass UI --- */
        .table {
            --bs-table-bg: transparent !important;
            --bs-table-accent-bg: transparent !important;
            --bs-table-striped-bg: rgba(255,255,255,.04) !important;
            --bs-table-striped-color: rgba(255,255,255,.92) !important;
            --bs-table-hover-bg: rgba(255,255,255,.06) !important;
            --bs-table-hover-color: rgba(255,255,255,.92) !important;
            color: rgba(255,255,255,.92) !important;
        }
        .table thead th,
        .table thead td {
            color: rgba(255,255,255,.70) !important;
            background-color: rgba(255,255,255,.04) !important;
        }
        .table > :not(caption) > * > * { background-color: transparent !important; box-shadow: none !important; }
        .table-striped > tbody > tr:nth-of-type(odd) > * { background-color: rgba(255,255,255,.03) !important; }
        .table tbody tr { border-top: 1px solid rgba(255,255,255,.10); }

        .list-group-item {
            background-color: transparent !important;
            color: rgba(255,255,255,.92) !important;
            border-color: rgba(255,255,255,.10) !important;
        }
    </style>
</head>
<body class="text-light">
<header class="sticky-top">
    <nav class="navbar navbar-expand-lg glass">
        <div class="container page-shell py-1">
            <a class="navbar-brand text-light fw-semibold" asp-controller="Home" asp-action="Index">
                <span class="brand-dot"></span> University
            </a>
            <button class="navbar-toggler text-light" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="nav">
                <ul class="navbar-nav me-auto gap-lg-1">
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Calendar" asp-action="Index">
                            <i class="bi bi-calendar3 me-1"></i> Kalendarz
                        </a>
                    </li>

                    @if (User.IsInRole("Student"))
                    {
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Students" asp-action="Index">
                                <i class="bi bi-mortarboard me-1"></i> Student
                            </a>
                        </li>
                    }

                    @if (User.IsInRole("Admin"))
                    {
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Admin" asp-action="Index">
                                <i class="bi bi-shield-lock me-1"></i> Admin
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="AdminGroups" asp-action="Index">
                                <i class="bi bi-people me-1"></i> Grupy
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="AdminSubjects" asp-action="Index">
                                <i class="bi bi-journal-bookmark me-1"></i> Przedmioty
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="AdminSubjectGroups" asp-action="PickSubject">
                                <i class="bi bi-diagram-3 me-1"></i> Przedmiot → Grupy
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="AdminLectures" asp-action="Index">
                                <i class="bi bi-easel me-1"></i> Zajęcia
                            </a>
                        </li>
                    }
                </ul>

                <partial name="_LoginPartial" />
            </div>
        </div>
    </nav>
</header>

<main class="container page-shell py-4">
    @if (TempData["ToastOk"] is string ok)
    {
        <div class="alert alert-success border-0 card-soft" role="alert">
            <i class="bi bi-check2-circle me-2"></i>@ok
        </div>
    }
    @if (TempData["ToastError"] is string err)
    {
        <div class="alert alert-danger border-0 card-soft" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>@err
        </div>
    }
    @RenderBody()
</main>

<footer class="py-4">
    <div class="container page-shell text-muted2 small">
        <span>© @DateTime.Now.Year University</span><span class="mx-2">•</span><span>Identity + EF Core + SQLite</span>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // bfcache fix: when user goes back after logout, browser may show cached page without requesting server
  window.addEventListener('pageshow', function (event) {
    if (event.persisted) {
      window.location.reload();
    }
  });
</script>

@RenderSection("Scripts", required: false)
</body>
</html>
